<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>Ginå¿«é€Ÿä¸Šæ‰‹ - è¾°é¢¨ä¾æ›</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="è¾°é¢¨ä¾æ›ä¸ªäººåšå®¢">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    <link rel="shortcut icon" href="https://766187397.github.io/images/f73a765045a245e9b8e594798465112.jpg" type="image/x-icon" />
    <meta name="description" content="Ginå¿«é€Ÿä¸Šæ‰‹ ä»Express&#x2F;Koa&#x2F;NestJSåˆ°Goè¯­è¨€Webå¼€å‘  å‰è¨€å¦‚æœä½ å·²ç»ç†Ÿæ‚‰Expressã€Koaæˆ–NestJSç­‰Node.jsæ¡†æ¶ï¼Œå­¦ä¹ Ginæ¡†æ¶å°†ä¼šéå¸¸é¡ºç•…ã€‚Ginæ˜¯Goè¯­è¨€ä¸­æœ€æµè¡Œçš„Webæ¡†æ¶ä¹‹ä¸€ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç®€æ´çš„APIå’Œä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€è‘—ç§°ã€‚ ç¯å¢ƒæ­å»º1. Goè¯­è¨€ç¯å¢ƒå®‰è£…12345678# ä¸‹è½½å¹¶å®‰è£…Go (https:&#x2F;&#x2F;golang.org&#x2F;dl&#x2F;)# éªŒè¯å®‰è£…">
<meta property="og:type" content="article">
<meta property="og:title" content="Ginå¿«é€Ÿä¸Šæ‰‹">
<meta property="og:url" content="https://766187397.github.io/2025/09/28/Gin%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/index.html">
<meta property="og:site_name" content="è¾°é¢¨ä¾æ›">
<meta property="og:description" content="Ginå¿«é€Ÿä¸Šæ‰‹ ä»Express&#x2F;Koa&#x2F;NestJSåˆ°Goè¯­è¨€Webå¼€å‘  å‰è¨€å¦‚æœä½ å·²ç»ç†Ÿæ‚‰Expressã€Koaæˆ–NestJSç­‰Node.jsæ¡†æ¶ï¼Œå­¦ä¹ Ginæ¡†æ¶å°†ä¼šéå¸¸é¡ºç•…ã€‚Ginæ˜¯Goè¯­è¨€ä¸­æœ€æµè¡Œçš„Webæ¡†æ¶ä¹‹ä¸€ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç®€æ´çš„APIå’Œä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€è‘—ç§°ã€‚ ç¯å¢ƒæ­å»º1. Goè¯­è¨€ç¯å¢ƒå®‰è£…12345678# ä¸‹è½½å¹¶å®‰è£…Go (https:&#x2F;&#x2F;golang.org&#x2F;dl&#x2F;)# éªŒè¯å®‰è£…">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-28T02:23:48.048Z">
<meta property="article:modified_time" content="2025-09-28T03:11:35.043Z">
<meta property="article:author" content="è¾°é¢¨ä¾æ›">
<meta property="article:tag" content="è¾°é¢¨ä¾æ›ä¸ªäººåšå®¢">
<meta name="twitter:card" content="summary">
    
<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1764232297493">
    
        <link rel="stylesheet" href="//at.alicdn.com/t/c/font_3274123_epi3bpf4j2f.css">
    
    <link rel="stylesheet" href="/css/style.css?v=1764232297493">

    
        
            <link rel="stylesheet" href="/custom.css?v=1764232297493">
        
    
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="mdui-drawer-body-left">
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://766187397.github.io/images/533cc5ef880911ebb6edd017c2d2eca2.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="è¾°é¢¨ä¾æ›" class="mdui-btn mdui-btn-icon"><img src="https://766187397.github.io/images/f73a765045a245e9b8e594798465112.jpg" alt="è¾°é¢¨ä¾æ›"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="è¾°é¢¨ä¾æ›">
            <img src="https://766187397.github.io/images/f73a765045a245e9b8e594798465112.jpg" alt="è¾°é¢¨ä¾æ›" alt="è¾°é¢¨ä¾æ›">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>æ–‡ç« </span>38</div>
        <div><span>æ ‡ç­¾</span>0</div>
        <div><span>åˆ†ç±»</span>12</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="å›åˆ°é¦–é¡µ">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                å›åˆ°é¦–é¡µ
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="æ–‡ç« å½’æ¡£">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                æ–‡ç« å½’æ¡£
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="æœç´¢" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>


	<script async src="/js/search.js?v=1764232297493"></script>



    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=766187397&website=www.oicqzone.com"
			target="_blank"
			mdui-tooltip="{content: 'QQ'}"
			style="
				color: rgb(249, 174, 8);
				background-color: rgba(249, 174, 8, .1);
			"
		>
			<i
				class="nexmoefont icon-QQ"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://space.bilibili.com/433804329"
			target="_blank"
			mdui-tooltip="{content: 'å“”å“©å“”å“©'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/766187397/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://gitee.com/sk20020228/"
			target="_blank"
			mdui-tooltip="{content: 'Gitee'}"
			style="
				color: rgb(165, 15, 15);
				background-color: rgba(165, 15, 15, .15);
			"
		>
			<i
				class="nexmoefont icon-gitee"
			></i> </a
		>
	</div>
</div>

    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æ–‡ç« åˆ†ç±»</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/AI/">AI</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Goè¯­è¨€/">Goè¯­è¨€</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/NestJS/">NestJS</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/NuxtJS/">NuxtJS</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/TS/">TS</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Vue/">Vue</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/å‰ç«¯/">å‰ç«¯</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/åŒ…ç®¡ç†å·¥å…·/">åŒ…ç®¡ç†å·¥å…·</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/åšå®¢/">åšå®¢</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/å°ç¨‹åº/">å°ç¨‹åº</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ/">æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/çŸ¥è¯†ç¢ç‰‡/">çŸ¥è¯†ç¢ç‰‡</a>
          <span class="category-list-count">8</span>
        </li>

        
      </ul>

    </div>
  </div>


    
        
        
    
        
        <!-- ä¸€è¨€ -->
<div class="nexmoe-widget-wrap">
  <h3 class="nexmoe-widget-title">
    ä¸€è¨€
  </h3>
  <div class="nexmoe-widget">
    <ul class="hitokoto-box">
      <li id="hitokoto_text_parent" class="hitokoto-text" hitokotoCategory="">
        <a href="#" id="hitokoto_text">
          
        </a>
        <a href="#" id="hitokoto_error_text" style="display: none;">
          
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  let hitokotoText = document.getElementById('hitokoto_text')
  let hitokotoErroText = document.getElementById('hitokoto_error_text')
  let hitokotoCategory = document.getElementById('hitokoto_text_parent').getAttribute('hitokotoCategory')
  window.onload = function () {
    let url = 'https://v1.hitokoto.cn'
    if (hitokotoCategory) {
      url += '?c=' + hitokotoCategory
    }
    fetch(url)
      .then(response => response.json())
      .then(data => {
        hitokotoText.innerText = "ã€Œ " + data.hitokoto + " ã€ from " + data.from
        hitokotoText.href = 'https://hitokoto.cn/?uuid=' + data.uuid
      })
      .catch((reason) => {
        console.error(11, reason)
        hitokotoText.style.display = 'none'
        hitokotoErroText.style.display = 'block'
      })
  }
</script>
    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æ–‡ç« å½’æ¡£</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">38</span></li></ul>
    </div>
  </div>



    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2025/11/27/AI+Figma%E7%94%9F%E6%88%90%E8%AE%BE%E8%AE%A1%E5%9B%BE/">AI+Figmaç”Ÿæˆè®¾è®¡å›¾</a>
          </li>
        
          <li>
            <a href="/2025/11/13/UniApp%20+%20Vue3%20+%20TS%20%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/">UniApp + Vue3 + TS å·¥ç¨‹åŒ–å®æˆ˜ç¬”è®°</a>
          </li>
        
          <li>
            <a href="/2025/11/13/%E5%85%8D%E8%B4%B9%E5%9F%9F%E5%90%8D/">å…è´¹åŸŸå</a>
          </li>
        
          <li>
            <a href="/2025/11/13/AI+Figma/">AI+Figma</a>
          </li>
        
          <li>
            <a href="/2025/10/20/%F0%9F%94%A5Knife4j%20vs%20Swagger%EF%BC%9ANode.js%20%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84API%E6%96%87%E6%A1%A3%E9%9D%A9%E5%91%BD%EF%BC%81/">ğŸ”¥Knife4j vs Swaggerï¼šNode.js å¼€å‘è€…çš„APIæ–‡æ¡£é©å‘½ï¼</a>
          </li>
        
      </ul>
    </div>
  </div>

    
        
</aside>
    <div class="nexmoe-copyright">
        &copy; 2025 è¾°é¢¨ä¾æ›
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn/">é„‚ICPå¤‡2020018486å·</a>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: NaN%;"> 
            <img src="https://766187397.github.io/images/Go.jpeg" alt="Ginå¿«é€Ÿä¸Šæ‰‹" loading="lazy">
            <h1>Ginå¿«é€Ÿä¸Šæ‰‹</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2025å¹´09æœˆ28æ—¥</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/categories/Go%E8%AF%AD%E8%A8%80/">Goè¯­è¨€</a>
        
        
    </div>
    
    
    
    
    
</div>

    <h1 id="Ginå¿«é€Ÿä¸Šæ‰‹"><a href="#Ginå¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="Ginå¿«é€Ÿä¸Šæ‰‹"></a>Ginå¿«é€Ÿä¸Šæ‰‹</h1><blockquote>
<p>ä»Express/Koa/NestJSåˆ°Goè¯­è¨€Webå¼€å‘</p>
</blockquote>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœä½ å·²ç»ç†Ÿæ‚‰Expressã€Koaæˆ–NestJSç­‰Node.jsæ¡†æ¶ï¼Œå­¦ä¹ Ginæ¡†æ¶å°†ä¼šéå¸¸é¡ºç•…ã€‚Ginæ˜¯Goè¯­è¨€ä¸­æœ€æµè¡Œçš„Webæ¡†æ¶ä¹‹ä¸€ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç®€æ´çš„APIå’Œä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€è‘—ç§°ã€‚</p>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="1-Goè¯­è¨€ç¯å¢ƒå®‰è£…"><a href="#1-Goè¯­è¨€ç¯å¢ƒå®‰è£…" class="headerlink" title="1. Goè¯­è¨€ç¯å¢ƒå®‰è£…"></a>1. Goè¯­è¨€ç¯å¢ƒå®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½å¹¶å®‰è£…Go (https://golang.org/dl/)</span></span><br><span class="line"><span class="comment"># éªŒè¯å®‰è£…</span></span><br><span class="line">$ go version</span><br><span class="line">go version go1.22.0 darwin/amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®GOPATHå’ŒGOROOTï¼ˆç°ä»£Goç‰ˆæœ¬é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼‰</span></span><br><span class="line">$ go <span class="built_in">env</span> GOPATH</span><br><span class="line">/Users/username/go</span><br></pre></td></tr></table></figure>

<h3 id="2-åˆ›å»ºé¡¹ç›®"><a href="#2-åˆ›å»ºé¡¹ç›®" class="headerlink" title="2. åˆ›å»ºé¡¹ç›®"></a>2. åˆ›å»ºé¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®ç›®å½•</span></span><br><span class="line">$ <span class="built_in">mkdir</span> gin-demo &amp;&amp; <span class="built_in">cd</span> gin-demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–Goæ¨¡å—</span></span><br><span class="line">$ go mod init gin-demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…Ginæ¡†æ¶ï¼ˆæ¨èä½¿ç”¨Go Modulesï¼‰</span></span><br><span class="line">$ go get github.com/gin-gonic/gin@latest</span><br></pre></td></tr></table></figure>

<h3 id="3-å¼€å‘å·¥å…·æ¨è"><a href="#3-å¼€å‘å·¥å…·æ¨è" class="headerlink" title="3. å¼€å‘å·¥å…·æ¨è"></a>3. å¼€å‘å·¥å…·æ¨è</h3><ul>
<li><strong>VS Code</strong> + Goæ’ä»¶</li>
<li><strong>GoLand</strong> (JetBrains IDE)</li>
<li><strong>Goland</strong> (ç¤¾åŒºç‰ˆ)</li>
</ul>
<h2 id="Goè¯­è¨€åŸºç¡€ï¼ˆå¯¹æ¯”JavaScript-TypeScriptï¼‰"><a href="#Goè¯­è¨€åŸºç¡€ï¼ˆå¯¹æ¯”JavaScript-TypeScriptï¼‰" class="headerlink" title="Goè¯­è¨€åŸºç¡€ï¼ˆå¯¹æ¯”JavaScript/TypeScriptï¼‰"></a>Goè¯­è¨€åŸºç¡€ï¼ˆå¯¹æ¯”JavaScript/TypeScriptï¼‰</h2><h3 id="å˜é‡å£°æ˜å·®å¼‚"><a href="#å˜é‡å£°æ˜å·®å¼‚" class="headerlink" title="å˜é‡å£°æ˜å·®å¼‚"></a>å˜é‡å£°æ˜å·®å¼‚</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Goè¯­è¨€</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// å˜é‡å£°æ˜ï¼ˆç±»å‹åœ¨åï¼‰</span></span><br><span class="line">    <span class="keyword">var</span> name <span class="type">string</span> = <span class="string">&quot;Gin&quot;</span></span><br><span class="line">    age := <span class="number">25</span> <span class="comment">// ç±»å‹æ¨æ–­</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¸¸é‡</span></span><br><span class="line">    <span class="keyword">const</span> version = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">    </span><br><span class="line">    fmt.Println(name, age, version)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScriptå¯¹æ¯”</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Gin&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">const</span> version = <span class="string">&quot;1.0.0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name, age, version);</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°å®šä¹‰å·®å¼‚"><a href="#å‡½æ•°å®šä¹‰å·®å¼‚" class="headerlink" title="å‡½æ•°å®šä¹‰å·®å¼‚"></a>å‡½æ•°å®šä¹‰å·®å¼‚</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Goè¯­è¨€å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a <span class="type">int</span>, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šè¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a, b <span class="type">float64</span>)</span></span> (<span class="type">float64</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, fmt.Errorf(<span class="string">&quot;é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    square := <span class="function"><span class="keyword">func</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x * x</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(square(<span class="number">5</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScriptå‡½æ•°å¯¹æ¯”</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°ä»£JSï¼ˆç®­å¤´å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">divide</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (b === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">square</span> = (<span class="params">x</span>) =&gt; x * x;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">square</span>(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯å¤„ç†å·®å¼‚"><a href="#é”™è¯¯å¤„ç†å·®å¼‚" class="headerlink" title="é”™è¯¯å¤„ç†å·®å¼‚"></a>é”™è¯¯å¤„ç†å·®å¼‚</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Goè¯­è¨€é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">(filename <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    data, err := os.ReadFile(filename)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;è¯»å–æ–‡ä»¶å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ•°æ®</span></span><br><span class="line">    fmt.Println(<span class="type">string</span>(data))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é”™è¯¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := readFile(<span class="string">&quot;config.yaml&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScripté”™è¯¯å¤„ç†ï¼ˆasync/awaitï¼‰</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readFile</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> fs.<span class="property">promises</span>.<span class="title function_">readFile</span>(filename, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`è¯»å–æ–‡ä»¶å¤±è´¥: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="title function_">readFile</span>(<span class="string">&#x27;config.yaml&#x27;</span>).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Ginæ¡†æ¶åŸºç¡€"><a href="#Ginæ¡†æ¶åŸºç¡€" class="headerlink" title="Ginæ¡†æ¶åŸºç¡€"></a>Ginæ¡†æ¶åŸºç¡€</h2><h3 id="1-ç¬¬ä¸€ä¸ªGinåº”ç”¨"><a href="#1-ç¬¬ä¸€ä¸ªGinåº”ç”¨" class="headerlink" title="1. ç¬¬ä¸€ä¸ªGinåº”ç”¨"></a>1. ç¬¬ä¸€ä¸ªGinåº”ç”¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºGinå®ä¾‹ï¼ˆç±»ä¼¼Expressçš„app = express()ï¼‰</span></span><br><span class="line">    r := gin.Default()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®šä¹‰è·¯ç”±ï¼ˆå¯¹æ¯”Expressçš„app.get()ï¼‰</span></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello Gin!&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯åŠ¨æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£8080ï¼‰</span></span><br><span class="line">    r.Run() <span class="comment">// ç›¸å½“äº app.listen(8080)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-è·¯ç”±å®šä¹‰å¯¹æ¯”"><a href="#2-è·¯ç”±å®šä¹‰å¯¹æ¯”" class="headerlink" title="2. è·¯ç”±å®šä¹‰å¯¹æ¯”"></a>2. è·¯ç”±å®šä¹‰å¯¹æ¯”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ginè·¯ç”±å®šä¹‰</span></span><br><span class="line">r.GET(<span class="string">&quot;/users&quot;</span>, getUsers)</span><br><span class="line">r.POST(<span class="string">&quot;/users&quot;</span>, createUser)</span><br><span class="line">r.PUT(<span class="string">&quot;/users/:id&quot;</span>, updateUser)</span><br><span class="line">r.DELETE(<span class="string">&quot;/users/:id&quot;</span>, deleteUser)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±ç»„ï¼ˆç±»ä¼¼Expressçš„Routerï¼‰</span></span><br><span class="line">api := r.Group(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    api.GET(<span class="string">&quot;/users&quot;</span>, getUsers)</span><br><span class="line">    api.POST(<span class="string">&quot;/users&quot;</span>, createUser)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯å¾„å‚æ•°</span></span><br><span class="line">r.GET(<span class="string">&quot;/users/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    id := c.Param(<span class="string">&quot;id&quot;</span>) <span class="comment">// ç±»ä¼¼Expressçš„req.params.id</span></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;id&quot;</span>: id&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">r.GET(<span class="string">&quot;/search&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    query := c.Query(<span class="string">&quot;q&quot;</span>) <span class="comment">// ç±»ä¼¼Expressçš„req.query.q</span></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;query&quot;</span>: query&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Expresså¯¹æ¯”</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>, getUsers);</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/users&#x27;</span>, createUser);</span><br><span class="line">app.<span class="title function_">put</span>(<span class="string">&#x27;/users/:id&#x27;</span>, updateUser);</span><br><span class="line">app.<span class="title function_">delete</span>(<span class="string">&#x27;/users/:id&#x27;</span>, deleteUser);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±ç»„</span></span><br><span class="line"><span class="keyword">const</span> apiRouter = express.<span class="title class_">Router</span>();</span><br><span class="line">apiRouter.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>, getUsers);</span><br><span class="line">apiRouter.<span class="title function_">post</span>(<span class="string">&#x27;/users&#x27;</span>, createUser);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, apiRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯å¾„å‚æ•°</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> query = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; query &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-è¯·æ±‚å’Œå“åº”å¤„ç†"><a href="#3-è¯·æ±‚å’Œå“åº”å¤„ç†" class="headerlink" title="3. è¯·æ±‚å’Œå“åº”å¤„ç†"></a>3. è¯·æ±‚å’Œå“åº”å¤„ç†</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚ä½“è§£æï¼ˆJSONï¼‰</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name  <span class="type">string</span> <span class="string">`json:&quot;name&quot; binding:&quot;required&quot;`</span></span><br><span class="line">    Email <span class="type">string</span> <span class="string">`json:&quot;email&quot; binding:&quot;required,email&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.POST(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> user User</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»‘å®šJSONï¼ˆç±»ä¼¼Expressçš„body-parserï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(<span class="number">201</span>, gin.H&#123;<span class="string">&quot;user&quot;</span>: user&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">r.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    file, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">    c.SaveUploadedFile(file, <span class="string">&quot;./uploads/&quot;</span>+file.Filename)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”ç±»å‹</span></span><br><span class="line">r.GET(<span class="string">&quot;/response&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// JSONå“åº”</span></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;json&quot;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²å“åº”</span></span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// HTMLå“åº”</span></span><br><span class="line">    c.HTML(<span class="number">200</span>, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Gin&quot;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line">    c.File(<span class="string">&quot;./downloads/file.zip&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="ä¸­é—´ä»¶ç³»ç»Ÿ"><a href="#ä¸­é—´ä»¶ç³»ç»Ÿ" class="headerlink" title="ä¸­é—´ä»¶ç³»ç»Ÿ"></a>ä¸­é—´ä»¶ç³»ç»Ÿ</h2><h3 id="1-å†…ç½®ä¸­é—´ä»¶"><a href="#1-å†…ç½®ä¸­é—´ä»¶" class="headerlink" title="1. å†…ç½®ä¸­é—´ä»¶"></a>1. å†…ç½®ä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.New()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨é»˜è®¤ä¸­é—´ä»¶ï¼ˆæ—¥å¿—å’Œæ¢å¤ï¼‰</span></span><br><span class="line">    r.Use(gin.Logger(), gin.Recovery())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆç±»ä¼¼Expressçš„express.static()ï¼‰</span></span><br><span class="line">    r.Static(<span class="string">&quot;/static&quot;</span>, <span class="string">&quot;./public&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å•ä¸ªè·¯ç”±ä¸­é—´ä»¶</span></span><br><span class="line">    r.GET(<span class="string">&quot;/admin&quot;</span>, authMiddleware(), adminHandler)</span><br><span class="line">    </span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼ˆç±»ä¼¼Expressçš„(req, res, next)ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">authMiddleware</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        token := c.GetHeader(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> token == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">            c.JSON(<span class="number">401</span>, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æœªæˆæƒ&quot;</span>&#125;)</span><br><span class="line">            c.Abort() <span class="comment">// ç±»ä¼¼Expressçš„next()ä½†ç”¨äºç»ˆæ­¢</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éªŒè¯tokené€»è¾‘</span></span><br><span class="line">        c.Set(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;authenticated-user&quot;</span>) <span class="comment">// ç±»ä¼¼Expressçš„req.user</span></span><br><span class="line">        c.Next() <span class="comment">// ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶/å¤„ç†å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº"><a href="#2-ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº" class="headerlink" title="2. ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº"></a>2. ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.New()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¨å±€ä¸­é—´ä»¶ï¼ˆæŒ‰æ·»åŠ é¡ºåºæ‰§è¡Œï¼‰</span></span><br><span class="line">    r.Use(loggerMiddleware)</span><br><span class="line">    r.Use(authMiddleware)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·¯ç”±ç»„ä¸­é—´ä»¶</span></span><br><span class="line">    admin := r.Group(<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">    admin.Use(adminAuthMiddleware)</span><br><span class="line">    &#123;</span><br><span class="line">        admin.GET(<span class="string">&quot;/dashboard&quot;</span>, dashboardHandler)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loggerMiddleware</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    c.Next()</span><br><span class="line">    latency := time.Since(start)</span><br><span class="line">    log.Printf(<span class="string">&quot;è¯·æ±‚ %s è€—æ—¶ %v&quot;</span>, c.Request.URL.Path, latency)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><h3 id="1-å¤šæ•°æ®åº“è¿æ¥é…ç½®"><a href="#1-å¤šæ•°æ®åº“è¿æ¥é…ç½®" class="headerlink" title="1. å¤šæ•°æ®åº“è¿æ¥é…ç½®"></a>1. å¤šæ•°æ®åº“è¿æ¥é…ç½®</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/database.go</span></span><br><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/driver/postgres&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/driver/sqlite&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DatabaseConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">    Driver   <span class="type">string</span> <span class="string">`yaml:&quot;driver&quot;`</span></span><br><span class="line">    Host     <span class="type">string</span> <span class="string">`yaml:&quot;host&quot;`</span></span><br><span class="line">    Port     <span class="type">string</span> <span class="string">`yaml:&quot;port&quot;`</span></span><br><span class="line">    Username <span class="type">string</span> <span class="string">`yaml:&quot;username&quot;`</span></span><br><span class="line">    Password <span class="type">string</span> <span class="string">`yaml:&quot;password&quot;`</span></span><br><span class="line">    Database <span class="type">string</span> <span class="string">`yaml:&quot;database&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectDB</span><span class="params">(config DatabaseConfig)</span></span> (*gorm.DB, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dialector gorm.Dialector</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> config.Driver &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;mysql&quot;</span>:</span><br><span class="line">        dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s:%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>,</span><br><span class="line">            config.Username, config.Password, config.Host, config.Port, config.Database)</span><br><span class="line">        dialector = mysql.Open(dsn)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;postgres&quot;</span>:</span><br><span class="line">        dsn := fmt.Sprintf(<span class="string">&quot;host=%s user=%s password=%s dbname=%s port=%s sslmode=disable&quot;</span>,</span><br><span class="line">            config.Host, config.Username, config.Password, config.Database, config.Port)</span><br><span class="line">        dialector = postgres.Open(dsn)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;sqlite&quot;</span>:</span><br><span class="line">        dialector = sqlite.Open(config.Database)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;ä¸æ”¯æŒçš„æ•°æ®åº“é©±åŠ¨: %s&quot;</span>, config.Driver)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> gorm.Open(dialector, &amp;gorm.Config&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    PrimaryDB   *gorm.DB</span><br><span class="line">    ReadOnlyDB   *gorm.DB</span><br><span class="line">    AnalyticsDB *gorm.DB</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitDatabases</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸»æ•°æ®åº“ï¼ˆè¯»å†™ï¼‰</span></span><br><span class="line">    PrimaryDB, err = ConnectDB(DatabaseConfig&#123;</span><br><span class="line">        Driver:   <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">        Host:     <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        Port:     <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">        Username: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        Password: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        Database: <span class="string">&quot;primary_db&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªè¯»æ•°æ®åº“å‰¯æœ¬</span></span><br><span class="line">    ReadOnlyDB, err = ConnectDB(DatabaseConfig&#123;</span><br><span class="line">        Driver:   <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">        Host:     <span class="string">&quot;readonly-host&quot;</span>,</span><br><span class="line">        Port:     <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">        Username: <span class="string">&quot;readonly_user&quot;</span>,</span><br><span class="line">        Password: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        Database: <span class="string">&quot;primary_db&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†ææ•°æ®åº“</span></span><br><span class="line">    AnalyticsDB, err = ConnectDB(DatabaseConfig&#123;</span><br><span class="line">        Driver:   <span class="string">&quot;postgres&quot;</span>,</span><br><span class="line">        Host:     <span class="string">&quot;analytics-host&quot;</span>,</span><br><span class="line">        Port:     <span class="string">&quot;5432&quot;</span>,</span><br><span class="line">        Username: <span class="string">&quot;analytics_user&quot;</span>,</span><br><span class="line">        Password: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        Database: <span class="string">&quot;analytics_db&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-æ¨¡å‹å®šä¹‰å’ŒCRUDæ“ä½œ"><a href="#2-æ¨¡å‹å®šä¹‰å’ŒCRUDæ“ä½œ" class="headerlink" title="2. æ¨¡å‹å®šä¹‰å’ŒCRUDæ“ä½œ"></a>2. æ¨¡å‹å®šä¹‰å’ŒCRUDæ“ä½œ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/user.go</span></span><br><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID        <span class="type">uint</span>           <span class="string">`gorm:&quot;primaryKey&quot; json:&quot;id&quot;`</span></span><br><span class="line">    Name      <span class="type">string</span>         <span class="string">`gorm:&quot;size:100;not null&quot; json:&quot;name&quot;`</span></span><br><span class="line">    Email     <span class="type">string</span>         <span class="string">`gorm:&quot;size:255;uniqueIndex;not null&quot; json:&quot;email&quot;`</span></span><br><span class="line">    Password  <span class="type">string</span>         <span class="string">`gorm:&quot;size:255;not null&quot; json:&quot;-&quot;`</span> <span class="comment">// ä¸åºåˆ—åŒ–åˆ°JSON</span></span><br><span class="line">    Age       <span class="type">int</span>            <span class="string">`gorm:&quot;default:0&quot; json:&quot;age&quot;`</span></span><br><span class="line">    CreatedAt time.Time      <span class="string">`json:&quot;created_at&quot;`</span></span><br><span class="line">    UpdatedAt time.Time      <span class="string">`json:&quot;updated_at&quot;`</span></span><br><span class="line">    DeletedAt gorm.DeletedAt <span class="string">`gorm:&quot;index&quot; json:&quot;-&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·è¡¨å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;users&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸šåŠ¡é€»è¾‘æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> BeforeCreate(tx *gorm.DB) <span class="type">error</span> &#123;</span><br><span class="line">    u.CreatedAt = time.Now()</span><br><span class="line">    u.UpdatedAt = time.Now()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> BeforeUpdate(tx *gorm.DB) <span class="type">error</span> &#123;</span><br><span class="line">    u.UpdatedAt = time.Now()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handlers/user.go</span></span><br><span class="line"><span class="keyword">package</span> handlers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/models&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">    DB *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUserHandler</span><span class="params">(db *gorm.DB)</span></span> *UserHandler &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;UserHandler&#123;DB: db&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆGET /usersï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *UserHandler)</span></span> GetUsers(c *gin.Context) &#123;</span><br><span class="line">    <span class="keyword">var</span> users []models.User</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†é¡µå‚æ•°</span></span><br><span class="line">    page, _ := strconv.Atoi(c.DefaultQuery(<span class="string">&quot;page&quot;</span>, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">    limit, _ := strconv.Atoi(c.DefaultQuery(<span class="string">&quot;limit&quot;</span>, <span class="string">&quot;10&quot;</span>))</span><br><span class="line">    offset := (page - <span class="number">1</span>) * limit</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">    result := h.DB.Offset(offset).Limit(limit).Find(&amp;users)</span><br><span class="line">    <span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æŸ¥è¯¢å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æ€»æ•°</span></span><br><span class="line">    <span class="keyword">var</span> total <span class="type">int64</span></span><br><span class="line">    h.DB.Model(&amp;models.User&#123;&#125;).Count(&amp;total)</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;users&quot;</span>: users,</span><br><span class="line">        <span class="string">&quot;pagination&quot;</span>: gin.H&#123;</span><br><span class="line">            <span class="string">&quot;page&quot;</span>:  page,</span><br><span class="line">            <span class="string">&quot;limit&quot;</span>: limit,</span><br><span class="line">            <span class="string">&quot;total&quot;</span>: total,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å•ä¸ªç”¨æˆ·ï¼ˆGET /users/:idï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *UserHandler)</span></span> GetUser(c *gin.Context) &#123;</span><br><span class="line">    id, err := strconv.Atoi(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æ— æ•ˆçš„ç”¨æˆ·ID&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    result := h.DB.First(&amp;user, id)</span><br><span class="line">    <span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> result.Error == gorm.ErrRecordNotFound &#123;</span><br><span class="line">            c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>&#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æŸ¥è¯¢å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;user&quot;</span>: user&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç”¨æˆ·ï¼ˆPOST /usersï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *UserHandler)</span></span> CreateUser(c *gin.Context) &#123;</span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯†ç åŠ å¯†ï¼ˆåœ¨å®é™…é¡¹ç›®ä¸­åº”è¯¥ä½¿ç”¨bcryptï¼‰</span></span><br><span class="line">    <span class="comment">// user.Password = hashPassword(user.Password)</span></span><br><span class="line">    </span><br><span class="line">    result := h.DB.Create(&amp;user)</span><br><span class="line">    <span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;user&quot;</span>: user&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°ç”¨æˆ·ï¼ˆPUT /users/:idï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *UserHandler)</span></span> UpdateUser(c *gin.Context) &#123;</span><br><span class="line">    id, err := strconv.Atoi(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æ— æ•ˆçš„ç”¨æˆ·ID&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    result := h.DB.First(&amp;user, id)</span><br><span class="line">    <span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> updateData <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;updateData); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°ç”¨æˆ·</span></span><br><span class="line">    h.DB.Model(&amp;user).Updates(updateData)</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;user&quot;</span>: user&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ç”¨æˆ·ï¼ˆDELETE /users/:idï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *UserHandler)</span></span> DeleteUser(c *gin.Context) &#123;</span><br><span class="line">    id, err := strconv.Atoi(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æ— æ•ˆçš„ç”¨æˆ·ID&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    result := h.DB.Delete(&amp;models.User&#123;&#125;, id)</span><br><span class="line">    <span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;åˆ é™¤å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> result.RowsAffected == <span class="number">0</span> &#123;</span><br><span class="line">        c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç”¨æˆ·åˆ é™¤æˆåŠŸ&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JWTè®¤è¯å’ŒåŠ å¯†"><a href="#JWTè®¤è¯å’ŒåŠ å¯†" class="headerlink" title="JWTè®¤è¯å’ŒåŠ å¯†"></a>JWTè®¤è¯å’ŒåŠ å¯†</h2><h3 id="1-JWTå·¥å…·ç±»"><a href="#1-JWTå·¥å…·ç±»" class="headerlink" title="1. JWTå·¥å…·ç±»"></a>1. JWTå·¥å…·ç±»</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/jwt.go</span></span><br><span class="line"><span class="keyword">package</span> utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/golang-jwt/jwt/v5&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jwtSecret = []<span class="type">byte</span>(<span class="string">&quot;your-secret-key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Claims <span class="keyword">struct</span> &#123;</span><br><span class="line">    UserID <span class="type">uint</span> <span class="string">`json:&quot;user_id&quot;`</span></span><br><span class="line">    jwt.RegisteredClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”ŸæˆJWT Token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateToken</span><span class="params">(userID <span class="type">uint</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    nowTime := time.Now()</span><br><span class="line">    expireTime := nowTime.Add(<span class="number">24</span> * time.Hour)</span><br><span class="line">    </span><br><span class="line">    claims := Claims&#123;</span><br><span class="line">        UserID: userID,</span><br><span class="line">        RegisteredClaims: jwt.RegisteredClaims&#123;</span><br><span class="line">            ExpiresAt: jwt.NewNumericDate(expireTime),</span><br><span class="line">            IssuedAt:  jwt.NewNumericDate(nowTime),</span><br><span class="line">            Issuer:    <span class="string">&quot;gin-demo&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    tokenClaims := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">    token, err := tokenClaims.SignedString(jwtSecret)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> token, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æJWT Token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseToken</span><span class="params">(token <span class="type">string</span>)</span></span> (*Claims, <span class="type">error</span>) &#123;</span><br><span class="line">    tokenClaims, err := jwt.ParseWithClaims(token, &amp;Claims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> jwtSecret, <span class="literal">nil</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> tokenClaims != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> claims, ok := tokenClaims.Claims.(*Claims); ok &amp;&amp; tokenClaims.Valid &#123;</span><br><span class="line">            <span class="keyword">return</span> claims, <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯Token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateToken</span><span class="params">(token <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    claims, err := ParseToken(token)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">return</span> claims.ExpiresAt.Time.After(time.Now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-å¯†ç åŠ å¯†å·¥å…·"><a href="#2-å¯†ç åŠ å¯†å·¥å…·" class="headerlink" title="2. å¯†ç åŠ å¯†å·¥å…·"></a>2. å¯†ç åŠ å¯†å·¥å…·</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/password.go</span></span><br><span class="line"><span class="keyword">package</span> utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;golang.org/x/crypto/bcrypt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ å¯†å¯†ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HashPassword</span><span class="params">(password <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    bytes, err := bcrypt.GenerateFromPassword([]<span class="type">byte</span>(password), bcrypt.DefaultCost)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(bytes), err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯å¯†ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckPasswordHash</span><span class="params">(password, hash <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    err := bcrypt.CompareHashAndPassword([]<span class="type">byte</span>(hash), []<span class="type">byte</span>(password))</span><br><span class="line">    <span class="keyword">return</span> err == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-è®¤è¯ä¸­é—´ä»¶"><a href="#3-è®¤è¯ä¸­é—´ä»¶" class="headerlink" title="3. è®¤è¯ä¸­é—´ä»¶"></a>3. è®¤è¯ä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware/auth.go</span></span><br><span class="line"><span class="keyword">package</span> middleware</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/utils&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JWTAuth</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä»Headerè·å–token</span></span><br><span class="line">        authHeader := c.GetHeader(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> authHeader == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">            c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;è¯·æä¾›è®¤è¯token&quot;</span>&#125;)</span><br><span class="line">            c.Abort()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥Beareræ ¼å¼</span></span><br><span class="line">        parts := strings.SplitN(authHeader, <span class="string">&quot; &quot;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> !(<span class="built_in">len</span>(parts) == <span class="number">2</span> &amp;&amp; parts[<span class="number">0</span>] == <span class="string">&quot;Bearer&quot;</span>) &#123;</span><br><span class="line">            c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;tokenæ ¼å¼é”™è¯¯&quot;</span>&#125;)</span><br><span class="line">            c.Abort()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è§£ætoken</span></span><br><span class="line">        claims, err := utils.ParseToken(parts[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æ— æ•ˆçš„token&quot;</span>&#125;)</span><br><span class="line">            c.Abort()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ä¸Šä¸‹æ–‡</span></span><br><span class="line">        c.Set(<span class="string">&quot;userID&quot;</span>, claims.UserID)</span><br><span class="line">        c.Next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-è®¤è¯è·¯ç”±"><a href="#4-è®¤è¯è·¯ç”±" class="headerlink" title="4. è®¤è¯è·¯ç”±"></a>4. è®¤è¯è·¯ç”±</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handlers/auth.go</span></span><br><span class="line"><span class="keyword">package</span> handlers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/models&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/utils&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AuthHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">    DB *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAuthHandler</span><span class="params">(db *gorm.DB)</span></span> *AuthHandler &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;AuthHandler&#123;DB: db&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *AuthHandler)</span></span> Register(c *gin.Context) &#123;</span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">var</span> existingUser models.User</span><br><span class="line">    <span class="keyword">if</span> err := h.DB.Where(<span class="string">&quot;email = ?&quot;</span>, user.Email).First(&amp;existingUser).Error; err == <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;é‚®ç®±å·²å­˜åœ¨&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ å¯†å¯†ç </span></span><br><span class="line">    hashedPassword, err := utils.HashPassword(user.Password)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;å¯†ç åŠ å¯†å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    user.Password = hashedPassword</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">if</span> err := h.DB.Create(&amp;user).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusCreated, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: gin.H&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:    user.ID,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:  user.Name,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: user.Email,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™»å½•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *AuthHandler)</span></span> Login(c *gin.Context) &#123;</span><br><span class="line">    <span class="keyword">var</span> loginData <span class="keyword">struct</span> &#123;</span><br><span class="line">        Email    <span class="type">string</span> <span class="string">`json:&quot;email&quot; binding:&quot;required,email&quot;`</span></span><br><span class="line">        Password <span class="type">string</span> <span class="string">`json:&quot;password&quot; binding:&quot;required&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;loginData); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    <span class="keyword">if</span> err := h.DB.Where(<span class="string">&quot;email = ?&quot;</span>, loginData.Email).First(&amp;user).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;é‚®ç®±æˆ–å¯†ç é”™è¯¯&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éªŒè¯å¯†ç </span></span><br><span class="line">    <span class="keyword">if</span> !utils.CheckPasswordHash(loginData.Password, user.Password) &#123;</span><br><span class="line">        c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;é‚®ç®±æˆ–å¯†ç é”™è¯¯&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”Ÿæˆtoken</span></span><br><span class="line">    token, err := utils.GenerateToken(user.ID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;tokenç”Ÿæˆå¤±è´¥&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;token&quot;</span>:   token,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: gin.H&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:    user.ID,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:  user.Name,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: user.Email,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *AuthHandler)</span></span> GetCurrentUser(c *gin.Context) &#123;</span><br><span class="line">    userID, exists := c.Get(<span class="string">&quot;userID&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> !exists &#123;</span><br><span class="line">        c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;æœªè®¤è¯&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> user models.User</span><br><span class="line">    <span class="keyword">if</span> err := h.DB.First(&amp;user, userID).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: gin.H&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:    user.ID,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:  user.Name,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: user.Email,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é¡¹ç›®ç»“æ„å’Œé…ç½®"><a href="#é¡¹ç›®ç»“æ„å’Œé…ç½®" class="headerlink" title="é¡¹ç›®ç»“æ„å’Œé…ç½®"></a>é¡¹ç›®ç»“æ„å’Œé…ç½®</h2><h3 id="1-å®Œæ•´çš„é¡¹ç›®ç»“æ„"><a href="#1-å®Œæ•´çš„é¡¹ç›®ç»“æ„" class="headerlink" title="1. å®Œæ•´çš„é¡¹ç›®ç»“æ„"></a>1. å®Œæ•´çš„é¡¹ç›®ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">gin-demo/</span><br><span class="line">â”œâ”€â”€ main.go                 # åº”ç”¨å…¥å£</span><br><span class="line">â”œâ”€â”€ go.mod                 # Goæ¨¡å—æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ go.sum                 # ä¾èµ–æ ¡éªŒ</span><br><span class="line">â”œâ”€â”€ config/</span><br><span class="line">â”‚   â”œâ”€â”€ config.go          # é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ database.go        # æ•°æ®åº“é…ç½®</span><br><span class="line">â”œâ”€â”€ models/</span><br><span class="line">â”‚   â”œâ”€â”€ user.go            # ç”¨æˆ·æ¨¡å‹</span><br><span class="line">â”‚   â””â”€â”€ product.go         # äº§å“æ¨¡å‹</span><br><span class="line">â”œâ”€â”€ handlers/</span><br><span class="line">â”‚   â”œâ”€â”€ user.go            # ç”¨æˆ·å¤„ç†å™¨</span><br><span class="line">â”‚   â”œâ”€â”€ auth.go            # è®¤è¯å¤„ç†å™¨</span><br><span class="line">â”‚   â””â”€â”€ product.go         # äº§å“å¤„ç†å™¨</span><br><span class="line">â”œâ”€â”€ middleware/</span><br><span class="line">â”‚   â”œâ”€â”€ auth.go            # è®¤è¯ä¸­é—´ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ logger.go          # æ—¥å¿—ä¸­é—´ä»¶</span><br><span class="line">â”‚   â””â”€â”€ cors.go            # CORSä¸­é—´ä»¶</span><br><span class="line">â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â”œâ”€â”€ jwt.go             # JWTå·¥å…·</span><br><span class="line">â”‚   â”œâ”€â”€ password.go        # å¯†ç å·¥å…·</span><br><span class="line">â”‚   â””â”€â”€ response.go        # å“åº”å·¥å…·</span><br><span class="line">â”œâ”€â”€ routes/</span><br><span class="line">â”‚   â””â”€â”€ routes.go          # è·¯ç”±å®šä¹‰</span><br><span class="line">â””â”€â”€ tests/</span><br><span class="line">    â”œâ”€â”€ user_test.go       # ç”¨æˆ·æµ‹è¯•</span><br><span class="line">    â””â”€â”€ auth_test.go       # è®¤è¯æµ‹è¯•</span><br></pre></td></tr></table></figure>

<h3 id="2-é…ç½®æ–‡ä»¶"><a href="#2-é…ç½®æ–‡ä»¶" class="headerlink" title="2. é…ç½®æ–‡ä»¶"></a>2. é…ç½®æ–‡ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/config.go</span></span><br><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/joho/godotenv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">    AppPort     <span class="type">string</span></span><br><span class="line">    DatabaseURL <span class="type">string</span></span><br><span class="line">    JWTSecret   <span class="type">string</span></span><br><span class="line">    DebugMode   <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoadConfig</span><span class="params">()</span></span> *Config &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½.envæ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> err := godotenv.Load(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;æœªæ‰¾åˆ°.envæ–‡ä»¶ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    debugMode, _ := strconv.ParseBool(getEnv(<span class="string">&quot;DEBUG&quot;</span>, <span class="string">&quot;false&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &amp;Config&#123;</span><br><span class="line">        AppPort:     getEnv(<span class="string">&quot;APP_PORT&quot;</span>, <span class="string">&quot;8080&quot;</span>),</span><br><span class="line">        DatabaseURL: getEnv(<span class="string">&quot;DATABASE_URL&quot;</span>, <span class="string">&quot;root:password@tcp(localhost:3306)/gin_demo&quot;</span>),</span><br><span class="line">        JWTSecret:   getEnv(<span class="string">&quot;JWT_SECRET&quot;</span>, <span class="string">&quot;your-secret-key&quot;</span>),</span><br><span class="line">        DebugMode:   debugMode,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getEnv</span><span class="params">(key, defaultValue <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> value := os.Getenv(key); value != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-è·¯ç”±å®šä¹‰"><a href="#3-è·¯ç”±å®šä¹‰" class="headerlink" title="3. è·¯ç”±å®šä¹‰"></a>3. è·¯ç”±å®šä¹‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/routes.go</span></span><br><span class="line"><span class="keyword">package</span> routes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/config&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/handlers&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/middleware&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupRoutes</span><span class="params">(router *gin.Engine, db *gorm.DB, cfg *config.Config)</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¤„ç†å™¨</span></span><br><span class="line">    userHandler := handlers.NewUserHandler(db)</span><br><span class="line">    authHandler := handlers.NewAuthHandler(db)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¬å…±è·¯ç”±</span></span><br><span class="line">    public := router.Group(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è®¤è¯è·¯ç”±</span></span><br><span class="line">        auth := public.Group(<span class="string">&quot;/auth&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            auth.POST(<span class="string">&quot;/register&quot;</span>, authHandler.Register)</span><br><span class="line">            auth.POST(<span class="string">&quot;/login&quot;</span>, authHandler.Login)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…¬å¼€çš„ç”¨æˆ·è·¯ç”±</span></span><br><span class="line">        public.GET(<span class="string">&quot;/users&quot;</span>, userHandler.GetUsers)</span><br><span class="line">        public.GET(<span class="string">&quot;/users/:id&quot;</span>, userHandler.GetUser)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éœ€è¦è®¤è¯çš„è·¯ç”±</span></span><br><span class="line">    protected := public.Group(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    protected.Use(middleware.JWTAuth())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·ç®¡ç†</span></span><br><span class="line">        users := protected.Group(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            users.POST(<span class="string">&quot;&quot;</span>, userHandler.CreateUser)</span><br><span class="line">            users.PUT(<span class="string">&quot;/:id&quot;</span>, userHandler.UpdateUser)</span><br><span class="line">            users.DELETE(<span class="string">&quot;/:id&quot;</span>, userHandler.DeleteUser)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">        protected.GET(<span class="string">&quot;/me&quot;</span>, authHandler.GetCurrentUser)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¥åº·æ£€æŸ¥</span></span><br><span class="line">    router.GET(<span class="string">&quot;/health&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;ok&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ä¸»ç¨‹åºå…¥å£"><a href="#4-ä¸»ç¨‹åºå…¥å£" class="headerlink" title="4. ä¸»ç¨‹åºå…¥å£"></a>4. ä¸»ç¨‹åºå…¥å£</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/config&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/models&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/routes&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½é…ç½®</span></span><br><span class="line">    cfg := config.LoadConfig()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®Ginæ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> cfg.DebugMode &#123;</span><br><span class="line">        gin.SetMode(gin.DebugMode)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        gin.SetMode(gin.ReleaseMode)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºGinå®ä¾‹</span></span><br><span class="line">    router := gin.Default()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿æ¥æ•°æ®åº“</span></span><br><span class="line">    db, err := config.ConnectDB()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;æ•°æ®åº“è¿æ¥å¤±è´¥:&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªåŠ¨è¿ç§»ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> cfg.DebugMode &#123;</span><br><span class="line">        err = db.AutoMigrate(&amp;models.User&#123;&#125;)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(<span class="string">&quot;æ•°æ®åº“è¿ç§»å¤±è´¥:&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®è·¯ç”±</span></span><br><span class="line">    routes.SetupRoutes(router, db, cfg)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">    log.Printf(<span class="string">&quot;æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ %s&quot;</span>, cfg.AppPort)</span><br><span class="line">    <span class="keyword">if</span> err := router.Run(<span class="string">&quot;:&quot;</span> + cfg.AppPort); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;æœåŠ¡å™¨å¯åŠ¨å¤±è´¥:&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•å’Œéƒ¨ç½²"><a href="#æµ‹è¯•å’Œéƒ¨ç½²" class="headerlink" title="æµ‹è¯•å’Œéƒ¨ç½²"></a>æµ‹è¯•å’Œéƒ¨ç½²</h2><h3 id="1-å•å…ƒæµ‹è¯•"><a href="#1-å•å…ƒæµ‹è¯•" class="headerlink" title="1. å•å…ƒæµ‹è¯•"></a>1. å•å…ƒæµ‹è¯•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tests/user_test.go</span></span><br><span class="line"><span class="keyword">package</span> tests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gin-demo/handlers&quot;</span></span><br><span class="line">    <span class="string">&quot;gin-demo/models&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http/httptest&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/driver/sqlite&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupTestDB</span><span class="params">()</span></span> *gorm.DB &#123;</span><br><span class="line">    db, err := gorm.Open(sqlite.Open(<span class="string">&quot;:memory:&quot;</span>), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;æµ‹è¯•æ•°æ®åº“è¿æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿ç§»è¡¨</span></span><br><span class="line">    db.AutoMigrate(&amp;models.User&#123;&#125;)</span><br><span class="line">    <span class="keyword">return</span> db</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetUsers</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®æµ‹è¯•æ•°æ®åº“</span></span><br><span class="line">    db := setupTestDB()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºæµ‹è¯•æ•°æ®</span></span><br><span class="line">    db.Create(&amp;models.User&#123;Name: <span class="string">&quot;æµ‹è¯•ç”¨æˆ·&quot;</span>, Email: <span class="string">&quot;test@example.com&quot;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå¤„ç†å™¨</span></span><br><span class="line">    handler := handlers.NewUserHandler(db)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºGinæµ‹è¯•ä¸Šä¸‹æ–‡</span></span><br><span class="line">    w := httptest.NewRecorder()</span><br><span class="line">    c, _ := gin.CreateTestContext(w)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œå¤„ç†å™¨</span></span><br><span class="line">    handler.GetUsers(c)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éªŒè¯å“åº”</span></span><br><span class="line">    assert.Equal(t, http.StatusOK, w.Code)</span><br><span class="line">    assert.Contains(t, w.Body.String(), <span class="string">&quot;æµ‹è¯•ç”¨æˆ·&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCreateUser</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    db := setupTestDB()</span><br><span class="line">    handler := handlers.NewUserHandler(db)</span><br><span class="line">    </span><br><span class="line">    w := httptest.NewRecorder()</span><br><span class="line">    c, _ := gin.CreateTestContext(w)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®JSONè¯·æ±‚ä½“</span></span><br><span class="line">    c.Request = httptest.NewRequest(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/users&quot;</span>, </span><br><span class="line">        strings.NewReader(<span class="string">`&#123;&quot;name&quot;:&quot;æ–°ç”¨æˆ·&quot;,&quot;email&quot;:&quot;new@example.com&quot;&#125;`</span>))</span><br><span class="line">    c.Request.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    handler.CreateUser(c)</span><br><span class="line">    </span><br><span class="line">    assert.Equal(t, http.StatusCreated, w.Code)</span><br><span class="line">    assert.Contains(t, w.Body.String(), <span class="string">&quot;æ–°ç”¨æˆ·&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-é›†æˆæµ‹è¯•"><a href="#2-é›†æˆæµ‹è¯•" class="headerlink" title="2. é›†æˆæµ‹è¯•"></a>2. é›†æˆæµ‹è¯•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tests/integration_test.go</span></span><br><span class="line"><span class="keyword">package</span> tests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http/httptest&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;gin-demo/main&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestUserCRUDIntegration</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨</span></span><br><span class="line">    router := main.SetupRouter()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ‹è¯•åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">    userData := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:  <span class="string">&quot;é›†æˆæµ‹è¯•ç”¨æˆ·&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;integration@test.com&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    jsonData, _ := json.Marshal(userData)</span><br><span class="line">    req, _ := http.NewRequest(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/api/users&quot;</span>, bytes.NewBuffer(jsonData))</span><br><span class="line">    req.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    w := httptest.NewRecorder()</span><br><span class="line">    router.ServeHTTP(w, req)</span><br><span class="line">    </span><br><span class="line">    assert.Equal(t, http.StatusCreated, w.Code)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£æå“åº”è·å–ç”¨æˆ·ID</span></span><br><span class="line">    <span class="keyword">var</span> response <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    json.Unmarshal(w.Body.Bytes(), &amp;response)</span><br><span class="line">    user := response[<span class="string">&quot;user&quot;</span>].(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">    userID := user[<span class="string">&quot;id&quot;</span>].(<span class="type">float64</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ‹è¯•è·å–ç”¨æˆ·</span></span><br><span class="line">    req, _ = http.NewRequest(<span class="string">&quot;GET&quot;</span>, fmt.Sprintf(<span class="string">&quot;/api/users/%.0f&quot;</span>, userID), <span class="literal">nil</span>)</span><br><span class="line">    w = httptest.NewRecorder()</span><br><span class="line">    router.ServeHTTP(w, req)</span><br><span class="line">    </span><br><span class="line">    assert.Equal(t, http.StatusOK, w.Code)</span><br><span class="line">    assert.Contains(t, w.Body.String(), <span class="string">&quot;é›†æˆæµ‹è¯•ç”¨æˆ·&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Dockeréƒ¨ç½²é…ç½®"><a href="#3-Dockeréƒ¨ç½²é…ç½®" class="headerlink" title="3. Dockeréƒ¨ç½²é…ç½®"></a>3. Dockeréƒ¨ç½²é…ç½®</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.22</span>-alpine AS builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å¿…è¦çš„å·¥å…·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache git</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶ä¾èµ–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> go.mod go.sum ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ä¾èµ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go mod download</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æºä»£ç </span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºåº”ç”¨</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œé˜¶æ®µ</span></span><br><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk --no-cache add ca-certificates</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /root/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ„å»ºé˜¶æ®µå¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/main .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> config/config.yaml ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²ç«¯å£</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œåº”ç”¨</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;./main&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_URL=mysql://user:password@db:3306/gin_demo</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JWT_SECRET=your-secret-key</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">rootpassword</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">gin_demo</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">password</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db_data:/var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db_data:</span></span><br></pre></td></tr></table></figure>

<h3 id="4-ç¯å¢ƒé…ç½®"><a href="#4-ç¯å¢ƒé…ç½®" class="headerlink" title="4. ç¯å¢ƒé…ç½®"></a>4. ç¯å¢ƒé…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/config.yaml</span></span><br><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">  <span class="attr">env:</span> <span class="string">&quot;production&quot;</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">&quot;localhost&quot;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">&quot;3306&quot;</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">&quot;user&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;password&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;gin_demo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">&quot;your-production-secret-key&quot;</span></span><br><span class="line">  <span class="attr">expires_in:</span> <span class="string">&quot;24h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">&quot;info&quot;</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">&quot;./logs/app.log&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.example</span></span><br><span class="line">APP_PORT=8080</span><br><span class="line">DATABASE_URL=mysql://user:password@localhost:3306/gin_demo</span><br><span class="line">JWT_SECRET=your-secret-key</span><br><span class="line">DEBUG=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ"><a href="#æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ"></a>æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ</h2><h3 id="1-è¿æ¥æ± é…ç½®"><a href="#1-è¿æ¥æ± é…ç½®" class="headerlink" title="1. è¿æ¥æ± é…ç½®"></a>1. è¿æ¥æ± é…ç½®</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/database.go (æ‰©å±•)</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectDBWithPool</span><span class="params">(config DatabaseConfig)</span></span> (*gorm.DB, <span class="type">error</span>) &#123;</span><br><span class="line">    dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s:%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>,</span><br><span class="line">        config.Username, config.Password, config.Host, config.Port, config.Database)</span><br><span class="line">    </span><br><span class="line">    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;</span><br><span class="line">        <span class="comment">// ç¦ç”¨é»˜è®¤äº‹åŠ¡ï¼ˆæé«˜æ€§èƒ½ï¼‰</span></span><br><span class="line">        SkipDefaultTransaction: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// é¢„ç¼–è¯‘SQL</span></span><br><span class="line">        PrepareStmt: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–åº•å±‚sql.DBè®¾ç½®è¿æ¥æ± </span></span><br><span class="line">    sqlDB, err := db.DB()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®è¿æ¥æ± å‚æ•°</span></span><br><span class="line">    sqlDB.SetMaxIdleConns(<span class="number">10</span>)           <span class="comment">// æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">    sqlDB.SetMaxOpenConns(<span class="number">100</span>)          <span class="comment">// æœ€å¤§æ‰“å¼€è¿æ¥æ•°</span></span><br><span class="line">    sqlDB.SetConnMaxLifetime(time.Hour) <span class="comment">// è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> db, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ç¼“å­˜ç­–ç•¥"><a href="#2-ç¼“å­˜ç­–ç•¥" class="headerlink" title="2. ç¼“å­˜ç­–ç•¥"></a>2. ç¼“å­˜ç­–ç•¥</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/cache.go</span></span><br><span class="line"><span class="keyword">package</span> utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cache <span class="keyword">struct</span> &#123;</span><br><span class="line">    client *redis.Client</span><br><span class="line">    ctx    context.Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCache</span><span class="params">(addr, password <span class="type">string</span>, db <span class="type">int</span>)</span></span> *Cache &#123;</span><br><span class="line">    client := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">        Addr:     addr,</span><br><span class="line">        Password: password,</span><br><span class="line">        DB:       db,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &amp;Cache&#123;</span><br><span class="line">        client: client,</span><br><span class="line">        ctx:    context.Background(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç¼“å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cache)</span></span> Set(key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;, expiration time.Duration) <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.client.Set(c.ctx, key, value, expiration).Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç¼“å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cache)</span></span> Get(key <span class="type">string</span>) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> c.client.Get(c.ctx, key).Result()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ç¼“å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cache)</span></span> Delete(key <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.client.Del(c.ctx, key).Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CacheUser</span><span class="params">(user models.User, cache *Cache)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    userJSON, err := json.Marshal(user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cache.Set(<span class="string">&quot;user:&quot;</span>+strconv.FormatUint(<span class="type">uint64</span>(user.ID), <span class="number">10</span>), </span><br><span class="line">        userJSON, <span class="number">30</span>*time.Minute)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ€§èƒ½ç›‘æ§"><a href="#3-æ€§èƒ½ç›‘æ§" class="headerlink" title="3. æ€§èƒ½ç›‘æ§"></a>3. æ€§èƒ½ç›‘æ§</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware/metrics.go</span></span><br><span class="line"><span class="keyword">package</span> middleware</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    requestDuration = prometheus.NewHistogramVec(</span><br><span class="line">        prometheus.HistogramOpts&#123;</span><br><span class="line">            Name: <span class="string">&quot;http_request_duration_seconds&quot;</span>,</span><br><span class="line">            Help: <span class="string">&quot;HTTPè¯·æ±‚è€—æ—¶&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        []<span class="type">string</span>&#123;<span class="string">&quot;method&quot;</span>, <span class="string">&quot;endpoint&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    requestCount = prometheus.NewCounterVec(</span><br><span class="line">        prometheus.CounterOpts&#123;</span><br><span class="line">            Name: <span class="string">&quot;http_requests_total&quot;</span>,</span><br><span class="line">            Help: <span class="string">&quot;HTTPè¯·æ±‚æ€»æ•°&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        []<span class="type">string</span>&#123;<span class="string">&quot;method&quot;</span>, <span class="string">&quot;endpoint&quot;</span>, <span class="string">&quot;status&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    prometheus.MustRegister(requestDuration, requestCount)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MetricsMiddleware</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        start := time.Now()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»§ç»­å¤„ç†è¯·æ±‚</span></span><br><span class="line">        c.Next()</span><br><span class="line">        </span><br><span class="line">        duration := time.Since(start).Seconds()</span><br><span class="line">        status := c.Writer.Status()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•æŒ‡æ ‡</span></span><br><span class="line">        requestDuration.WithLabelValues(</span><br><span class="line">            c.Request.Method, </span><br><span class="line">            c.FullPath(),</span><br><span class="line">        ).Observe(duration)</span><br><span class="line">        </span><br><span class="line">        requestCount.WithLabelValues(</span><br><span class="line">            c.Request.Method, </span><br><span class="line">            c.FullPath(),</span><br><span class="line">            strconv.Itoa(status),</span><br><span class="line">        ).Inc()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æš´éœ²æŒ‡æ ‡ç«¯ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MetricsHandler</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    h := promhttp.Handler()</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        h.ServeHTTP(c.Writer, c.Request)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="Ginæ¡†æ¶ä¼˜åŠ¿"><a href="#Ginæ¡†æ¶ä¼˜åŠ¿" class="headerlink" title="Ginæ¡†æ¶ä¼˜åŠ¿"></a>Ginæ¡†æ¶ä¼˜åŠ¿</h3><ol>
<li><strong>é«˜æ€§èƒ½</strong>: åŸºäºGoè¯­è¨€çš„å¹¶å‘ç‰¹æ€§ï¼Œæ€§èƒ½è¿œè¶…Node.jsæ¡†æ¶</li>
<li><strong>ç®€æ´API</strong>: ç±»ä¼¼Expressçš„ç›´è§‚APIè®¾è®¡ï¼Œå­¦ä¹ æˆæœ¬ä½</li>
<li><strong>ä¸°å¯Œä¸­é—´ä»¶</strong>: å†…ç½®å¸¸ç”¨ä¸­é—´ä»¶ï¼Œç”Ÿæ€å®Œå–„</li>
<li><strong>å¼ºç±»å‹</strong>: Goè¯­è¨€çš„ç±»å‹å®‰å…¨å‡å°‘è¿è¡Œæ—¶é”™è¯¯</li>
</ol>
<h3 id="ä»Node-jsè¿ç§»å»ºè®®"><a href="#ä»Node-jsè¿ç§»å»ºè®®" class="headerlink" title="ä»Node.jsè¿ç§»å»ºè®®"></a>ä»Node.jsè¿ç§»å»ºè®®</h3><ol>
<li><strong>é”™è¯¯å¤„ç†</strong>: Goä½¿ç”¨æ˜¾å¼é”™è¯¯è¿”å›ï¼Œæ›¿ä»£JSçš„try-catch</li>
<li><strong>å¹¶å‘æ¨¡å‹</strong>: ç†è§£goroutineå’Œchannelï¼Œæ›¿ä»£async/await</li>
<li><strong>ç±»å‹ç³»ç»Ÿ</strong>: å……åˆ†åˆ©ç”¨Goçš„å¼ºç±»å‹ä¼˜åŠ¿</li>
<li><strong>ä¾èµ–ç®¡ç†</strong>: ä½¿ç”¨Go Modulesæ›¿ä»£npm</li>
</ol>
<h3 id="ä¸‹ä¸€æ­¥å­¦ä¹ "><a href="#ä¸‹ä¸€æ­¥å­¦ä¹ " class="headerlink" title="ä¸‹ä¸€æ­¥å­¦ä¹ "></a>ä¸‹ä¸€æ­¥å­¦ä¹ </h3><ol>
<li><strong>å¾®æœåŠ¡æ¶æ„</strong>: å­¦ä¹ gRPCå’Œå¾®æœåŠ¡é€šä¿¡</li>
<li><strong>å®¹å™¨åŒ–éƒ¨ç½²</strong>: æŒæ¡Dockerå’ŒKubernetes</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>: é›†æˆPrometheuså’ŒGrafana</li>
<li><strong>CI/CD</strong>: å»ºç«‹è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</li>
</ol>
<p>è¿™ä»½ç¬”è®°æ¶µç›–äº†Ginæ¡†æ¶çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®é™…åº”ç”¨ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä»Node.jså¼€å‘è½¬å‘Goè¯­è¨€Webå¼€å‘ã€‚é€šè¿‡å®é™…é¡¹ç›®ç»ƒä¹ ï¼Œä½ å°†èƒ½å¤Ÿç†Ÿç»ƒæŒæ¡Ginæ¡†æ¶å¹¶æ„å»ºé«˜æ€§èƒ½çš„Webåº”ç”¨ã€‚</p>

    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>è¾°é¢¨ä¾æ›<br>
        <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://766187397.github.io/2025/09/28/Gin%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" title="https:&#x2F;&#x2F;766187397.github.io&#x2F;2025&#x2F;09&#x2F;28&#x2F;Gin%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;766187397.github.io&#x2F;2025&#x2F;09&#x2F;28&#x2F;Gin%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B&#x2F;</a><br>
        
            <strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> åè®®è¿›è¡Œè®¸å¯
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
</div>

  
      <div class="nexmoe-post-footer">
          
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Gin%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">1.</span> <span class="toc-text">Ginå¿«é€Ÿä¸Šæ‰‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Go%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. Goè¯­è¨€ç¯å¢ƒå®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. åˆ›å»ºé¡¹ç›®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. å¼€å‘å·¥å…·æ¨è</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%EF%BC%88%E5%AF%B9%E6%AF%94JavaScript-TypeScript%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">Goè¯­è¨€åŸºç¡€ï¼ˆå¯¹æ¯”JavaScript&#x2F;TypeScriptï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E5%B7%AE%E5%BC%82"><span class="toc-number">1.3.1.</span> <span class="toc-text">å˜é‡å£°æ˜å·®å¼‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%B7%AE%E5%BC%82"><span class="toc-number">1.3.2.</span> <span class="toc-text">å‡½æ•°å®šä¹‰å·®å¼‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%B7%AE%E5%BC%82"><span class="toc-number">1.3.3.</span> <span class="toc-text">é”™è¯¯å¤„ç†å·®å¼‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gin%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80"><span class="toc-number">1.4.</span> <span class="toc-text">Ginæ¡†æ¶åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E4%B8%AAGin%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. ç¬¬ä¸€ä¸ªGinåº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%B7%AF%E7%94%B1%E5%AE%9A%E4%B9%89%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. è·¯ç”±å®šä¹‰å¯¹æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. è¯·æ±‚å’Œå“åº”å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.</span> <span class="toc-text">ä¸­é—´ä»¶ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%86%85%E7%BD%AE%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. å†…ç½®ä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">æ•°æ®åº“æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. å¤šæ•°æ®åº“è¿æ¥é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89%E5%92%8CCRUD%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. æ¨¡å‹å®šä¹‰å’ŒCRUDæ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWT%E8%AE%A4%E8%AF%81%E5%92%8C%E5%8A%A0%E5%AF%86"><span class="toc-number">1.7.</span> <span class="toc-text">JWTè®¤è¯å’ŒåŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-JWT%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.7.1.</span> <span class="toc-text">1. JWTå·¥å…·ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E5%B7%A5%E5%85%B7"><span class="toc-number">1.7.2.</span> <span class="toc-text">2. å¯†ç åŠ å¯†å·¥å…·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%A4%E8%AF%81%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.7.3.</span> <span class="toc-text">3. è®¤è¯ä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AE%A4%E8%AF%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.7.4.</span> <span class="toc-text">4. è®¤è¯è·¯ç”±</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.8.</span> <span class="toc-text">é¡¹ç›®ç»“æ„å’Œé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%8C%E6%95%B4%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. å®Œæ•´çš„é¡¹ç›®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%B7%AF%E7%94%B1%E5%AE%9A%E4%B9%89"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. è·¯ç”±å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%BB%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3"><span class="toc-number">1.8.4.</span> <span class="toc-text">4. ä¸»ç¨‹åºå…¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%92%8C%E9%83%A8%E7%BD%B2"><span class="toc-number">1.9.</span> <span class="toc-text">æµ‹è¯•å’Œéƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.1.</span> <span class="toc-text">1. å•å…ƒæµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.2.</span> <span class="toc-text">2. é›†æˆæµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Docker%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.3.</span> <span class="toc-text">3. Dockeréƒ¨ç½²é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.4.</span> <span class="toc-text">4. ç¯å¢ƒé…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.10.</span> <span class="toc-text">æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BF%9E%E6%8E%A5%E6%B1%A0%E9%85%8D%E7%BD%AE"><span class="toc-number">1.10.1.</span> <span class="toc-text">1. è¿æ¥æ± é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.2.</span> <span class="toc-text">2. ç¼“å­˜ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7"><span class="toc-number">1.10.3.</span> <span class="toc-text">3. æ€§èƒ½ç›‘æ§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.11.</span> <span class="toc-text">æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gin%E6%A1%86%E6%9E%B6%E4%BC%98%E5%8A%BF"><span class="toc-number">1.11.1.</span> <span class="toc-text">Ginæ¡†æ¶ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8ENode-js%E8%BF%81%E7%A7%BB%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.11.2.</span> <span class="toc-text">ä»Node.jsè¿ç§»å»ºè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.11.3.</span> <span class="toc-text">ä¸‹ä¸€æ­¥å­¦ä¹ </span></a></li></ol></li></ol></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <div id="nexmoe-search-space">
	<div class="search-container">
		<div class="search-header">
			<div class="search-input-container">
				<input
					class="search-input"
					type="text"
					placeholder="æœç´¢"
					oninput="sinput();"
				/>
			</div>
			<a class="search-close" onclick="sclose();">Ã—</a>
		</div>
		<div class="search-body"></div>
	</div>
</div>

    
<script src="/lib/mdui_043tiny/mdui.js"></script>
<script src="/lib/fancybox/fancybox.umd.js"></script>


 

<script async src="/js/app.js?v=1764232297507"></script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2058306854838448" crossorigin="anonymous"></script>

</body>

</html>
